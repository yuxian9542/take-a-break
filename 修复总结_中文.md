# ä¿®å¤æ€»ç»“ï¼šä» Mock æ•°æ®åˆ°çœŸå® Google Maps API

## ğŸ¯ é—®é¢˜æè¿°

ç”¨æˆ·æŠ¥å‘Šè™½ç„¶è®¾ç½®äº† Google Maps API Key åœ¨ `.env` æ–‡ä»¶ä¸­ï¼Œä½†æœåŠ¡å™¨æ—¥å¿—ä»æ˜¾ç¤ºï¼š
```
[MapService] Using mock places data
[MapService] Using heuristic routing
```

## ğŸ” æ ¹æœ¬åŸå› 

ç¯å¢ƒå˜é‡åŠ è½½è·¯å¾„é—®é¢˜ï¼š

1. **`.env` æ–‡ä»¶ä½ç½®**ï¼šé¡¹ç›®æ ¹ç›®å½• `/Users/ming/Documents/take-a-break/.env`

2. **æœåŠ¡è¿è¡Œç›®å½•**ï¼š`services/api/` 

3. **é…ç½®åŠ è½½ä»£ç **ï¼š
   ```typescript
   // packages/config/src/index.ts (ä¿®æ”¹å‰)
   import { config } from 'dotenv';
   config();  // âŒ ä» process.cwd() æŸ¥æ‰¾ .env
   ```

4. **é—®é¢˜**ï¼š`dotenv` é»˜è®¤ä»å½“å‰å·¥ä½œç›®å½• (`process.cwd()`) æŸ¥æ‰¾ `.env`ï¼Œä½†æœåŠ¡åœ¨å­ç›®å½•è¿è¡Œï¼Œæ‰¾ä¸åˆ°æ ¹ç›®å½•çš„ `.env` æ–‡ä»¶ã€‚

## âœ… è§£å†³æ–¹æ¡ˆ

ä¿®æ”¹ `packages/config/src/index.ts`ï¼Œæ˜¾å¼æŒ‡å®šä»é¡¹ç›®æ ¹ç›®å½•åŠ è½½ `.env`ï¼š

```typescript
import { config } from 'dotenv';
import { fileURLToPath } from 'url';
import { dirname, join } from 'path';

// è®¡ç®—é¡¹ç›®æ ¹ç›®å½•è·¯å¾„
const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);
const workspaceRoot = join(__dirname, '../../..');

// ä»æ ¹ç›®å½•åŠ è½½ .env
config({ path: join(workspaceRoot, '.env') });
```

### è·¯å¾„è®¡ç®—é€»è¾‘

```
å½“å‰æ–‡ä»¶: packages/config/src/index.ts
__dirname:  packages/config/src/
../       :  packages/config/
../../    :  packages/
../../..  :  é¡¹ç›®æ ¹ç›®å½• âœ…
```

## ğŸ§ª éªŒè¯ç»“æœ

ä¿®æ”¹åï¼ŒAPI æµ‹è¯•è¿”å›çœŸå®çš„ Google Places æ•°æ®ï¼š

```json
{
  "places": [
    {
      "id": "ChIJXwWcTQSBhYARWTFH-P20ENc",
      "name": "Cafe Angolo",
      "lat": 37.7995782,
      "lng": -122.4093972,
      "address": "501 Columbus Ave, San Francisco",
      "rating": 4.7,
      "isOpenNow": false
    }
    // ... æ›´å¤šçœŸå®åœ°ç‚¹
  ]
}
```

### å¯¹æ¯”

| ç‰¹å¾ | Mock æ•°æ® | çœŸå® API |
|------|----------|----------|
| åœ°ç‚¹åç§° | "Riverside Park - Cherry Walk" | "Cafe Angolo" |
| åœ°å€ | "Riverside Park, New York, NY" | "501 Columbus Ave, San Francisco" |
| ID | "spot_001" | "ChIJXwW..." (Google Place ID) |
| æ•°é‡ | å›ºå®š 10-18 ä¸ª | æ ¹æ®æœç´¢å‚æ•°åŠ¨æ€å˜åŒ– |

## ğŸ› ï¸ é™„åŠ ä¿®å¤

### 1. ç«¯å£å ç”¨é—®é¢˜

**é—®é¢˜**ï¼š`EADDRINUSE: address already in use 0.0.0.0:3333`

**åŸå› **ï¼šæœ‰æ—§çš„æœåŠ¡è¿›ç¨‹ä»åœ¨è¿è¡Œ

**è§£å†³**ï¼š
```bash
# æŸ¥æ‰¾å ç”¨è¿›ç¨‹
ps aux | grep -E "tsx.*server" | grep -v grep

# åœæ­¢æ—§è¿›ç¨‹
kill 29192 31507
```

### 2. åˆ›å»ºæ£€æŸ¥è„šæœ¬

åˆ›å»º `scripts/check-env.sh` ç”¨äºéªŒè¯é…ç½®ï¼š

```bash
#!/bin/bash
# æ£€æŸ¥ .env æ–‡ä»¶ã€API Keyã€ç«¯å£çŠ¶æ€ç­‰

pnpm run check:env
```

### 3. åˆ›å»ºæµ‹è¯•è„šæœ¬

åˆ›å»º `scripts/test-map-api.sh` ç”¨äºæµ‹è¯• APIï¼š

```bash
#!/bin/bash
# æµ‹è¯•åœ°ç‚¹æœç´¢ã€å¯¼èˆªè·¯çº¿ç­‰åŠŸèƒ½

pnpm run test:map-api
```

## ğŸ“‹ ä¿®æ”¹çš„æ–‡ä»¶

### æ ¸å¿ƒä¿®å¤
1. `packages/config/src/index.ts` - ä¿®å¤ç¯å¢ƒå˜é‡åŠ è½½è·¯å¾„

### å·¥å…·è„šæœ¬
2. `scripts/check-env.sh` - ç¯å¢ƒæ£€æŸ¥è„šæœ¬
3. `scripts/test-map-api.sh` - API æµ‹è¯•è„šæœ¬

### é…ç½®æ›´æ–°
4. `package.json` - æ·»åŠ ä¾¿æ·å‘½ä»¤ï¼š
   - `pnpm run check:env`
   - `pnpm run test:map-api`

### æ–‡æ¡£
5. `SUCCESS_çœŸå®åœ°å›¾å·²å¯ç”¨.md` - æˆåŠŸéªŒè¯æ–‡æ¡£
6. `ä¿®å¤æ€»ç»“_ä¸­æ–‡.md` - æœ¬æ–‡æ¡£

## ğŸ“ æŠ€æœ¯è¦ç‚¹

### 1. ESM æ¨¡å—ä¸­çš„è·¯å¾„å¤„ç†

åœ¨ ES æ¨¡å—ä¸­ï¼Œ`__dirname` ä¸å¯ç”¨ï¼Œéœ€è¦ï¼š

```typescript
import { fileURLToPath } from 'url';
import { dirname } from 'path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);
```

### 2. Monorepo ä¸­çš„è·¯å¾„è§£æ

åœ¨ monorepo ç»“æ„ä¸­ï¼Œéœ€è¦ä»åŒ…çš„ä½ç½®è®¡ç®—åˆ°æ ¹ç›®å½•ï¼š

```
workspace/
â”œâ”€â”€ packages/
â”‚   â””â”€â”€ config/src/     â† å½“å‰ä½ç½®
â”œâ”€â”€ services/
â”‚   â””â”€â”€ api/
â””â”€â”€ .env                â† ç›®æ ‡ä½ç½®
```

### 3. dotenv é…ç½®

```typescript
// é»˜è®¤è¡Œä¸º (ä¸æ¨èåœ¨ monorepo ä¸­)
config();  // ä» process.cwd() æŸ¥æ‰¾

// æ˜¾å¼è·¯å¾„ (æ¨è)
config({ path: '/absolute/path/to/.env' });
```

## âœ… éªŒè¯æ¸…å•

- [x] `.env` æ–‡ä»¶åœ¨æ ¹ç›®å½•
- [x] `GOOGLE_MAPS_API_KEY` å·²è®¾ç½®
- [x] `USE_REAL_MAP_API=true`
- [x] é…ç½®åŠ è½½è·¯å¾„å·²ä¿®å¤
- [x] ç«¯å£å†²çªå·²è§£å†³
- [x] API è¿”å›çœŸå®æ•°æ®
- [x] æµ‹è¯•è„šæœ¬å·²åˆ›å»º
- [x] æ–‡æ¡£å·²æ›´æ–°

## ğŸš€ å¿«é€Ÿå‘½ä»¤

```bash
# æ£€æŸ¥é…ç½®
pnpm run check:env

# æµ‹è¯• API
pnpm run test:map-api

# å¯åŠ¨æœåŠ¡
pnpm run dev:api

# è®¾ç½®æ¨¡æ‹Ÿå™¨ä½ç½®
pnpm run sim:location:sf   # æ—§é‡‘å±±
pnpm run sim:location:nyc  # çº½çº¦
```

## ğŸ“š ç›¸å…³é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### Q: ä¸ºä»€ä¹ˆæœåŠ¡å™¨æ˜¾ç¤º "Using mock places data"ï¼Ÿ

**A**: ç¯å¢ƒå˜é‡æœªæ­£ç¡®åŠ è½½ã€‚æ£€æŸ¥ï¼š
1. `.env` æ–‡ä»¶æ˜¯å¦å­˜åœ¨äºæ ¹ç›®å½•
2. `GOOGLE_MAPS_API_KEY` æ˜¯å¦è®¾ç½®
3. `USE_REAL_MAP_API` æ˜¯å¦ä¸º `true`
4. é…ç½®åŠ è½½è·¯å¾„æ˜¯å¦æ­£ç¡®

### Q: å¦‚ä½•éªŒè¯ Google Maps API æ˜¯å¦å·¥ä½œï¼Ÿ

**A**: è¿è¡Œæµ‹è¯•ï¼š
```bash
pnpm run test:map-api
```

æŸ¥çœ‹è¿”å›çš„åœ°ç‚¹æ˜¯å¦ä¸ºçœŸå®åœ°ç‚¹ï¼ˆä¸æ˜¯ Mock æ•°æ®ä¸­çš„å›ºå®šåç§°ï¼‰ã€‚

### Q: èƒ½å¦åœ¨å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨ä¸åŒçš„é…ç½®ï¼Ÿ

**A**: å¯ä»¥ã€‚åœ¨ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„ `.env` æ–‡ä»¶ï¼š
- `.env.development`
- `.env.production`

ç„¶ååœ¨ `config()` è°ƒç”¨ä¸­æŒ‡å®šï¼š
```typescript
const envFile = process.env.NODE_ENV === 'production' 
  ? '.env.production' 
  : '.env.development';

config({ path: join(workspaceRoot, envFile) });
```

## ğŸ‰ æˆæœ

ç°åœ¨æ‚¨çš„åº”ç”¨ï¼š
- âœ… æ­£ç¡®åŠ è½½ç¯å¢ƒå˜é‡
- âœ… ä½¿ç”¨çœŸå®çš„ Google Maps API
- âœ… æœç´¢çœŸå®çš„åœ°ç‚¹
- âœ… è®¡ç®—çœŸå®çš„è·¯çº¿
- âœ… æ”¯æŒå…¨çƒä»»ä½•ä½ç½®

é—®é¢˜å®Œå…¨è§£å†³ï¼ğŸŠ



