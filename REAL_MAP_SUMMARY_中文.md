# çœŸå®žåœ°å›¾é›†æˆå®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

æ‚¨çš„åº”ç”¨çŽ°åœ¨å·²ç»ä»Ž **Mock æ•°æ®** å‡çº§åˆ° **çœŸå®žçš„ Google Maps API** é›†æˆï¼

## ðŸŽ¯ å®žçŽ°çš„åŠŸèƒ½

### 1. çœŸå®žåœ°ç‚¹æœç´¢
- âœ… ä½¿ç”¨ Google Places API
- âœ… æœç´¢ç”¨æˆ·å‘¨å›´çš„çœŸå®žåœ°ç‚¹
- âœ… æ”¯æŒå…¬å›­ã€å’–å•¡é¦†ã€å›¾ä¹¦é¦†ç­‰ç±»åž‹
- âœ… æ˜¾ç¤ºè¯„åˆ†å’Œè¥ä¸šçŠ¶æ€
- âœ… ç²¾ç¡®çš„è·ç¦»è®¡ç®—

### 2. çœŸå®žå¯¼èˆªè·¯çº¿
- âœ… ä½¿ç”¨ Google Directions API
- âœ… è®¡ç®—æœ€ä¼˜æ­¥è¡Œè·¯çº¿
- âœ… ç²¾ç¡®çš„æ—¶é—´å’Œè·ç¦»
- âœ… é€æ­¥å¯¼èˆªæŒ‡ç¤º
- âœ… åœ°å›¾ä¸Šæ˜¾ç¤ºçœŸå®žè·¯å¾„ï¼ˆPolylineï¼‰

### 3. æ™ºèƒ½åˆ‡æ¢ç³»ç»Ÿ
- âœ… å¯ä»¥éšæ—¶åœ¨ Mock å’ŒçœŸå®ž API ä¹‹é—´åˆ‡æ¢
- âœ… é€šè¿‡çŽ¯å¢ƒå˜é‡æŽ§åˆ¶
- âœ… å‰ç«¯æ— éœ€ä¿®æ”¹

## ðŸ“ æ–°å¢žçš„æ–‡ä»¶

### æ ¸å¿ƒå®žçŽ°

1. **`services/map/src/providers/google-places-provider.ts`**
   - Google Places API é›†æˆ
   - åœ°ç‚¹æœç´¢å’Œè¯¦æƒ…æŸ¥è¯¢

2. **`services/map/src/routing/engines/google-directions-engine.ts`**
   - Google Directions API é›†æˆ
   - è·¯çº¿è®¡ç®—å’Œ Polyline è§£ç 

3. **`services/map/src/index.ts`** (æ›´æ–°)
   - å¯¼å‡ºæ–°çš„ API æä¾›è€…

### é…ç½®æ–‡ä»¶

4. **`packages/config/src/schema.ts`** (æ›´æ–°)
   - æ·»åŠ  Google Maps API é…ç½®

5. **`services/api/src/routes/map.ts`** (æ›´æ–°)
   - æ™ºèƒ½åˆ‡æ¢ Mock/çœŸå®ž API

### æ–‡æ¡£

6. **`GOOGLE_MAPS_SETUP.md`**
   - Google Maps API è¯¦ç»†é…ç½®æŒ‡å—
   - API å¯†é’¥èŽ·å–å’Œå®‰å…¨è®¾ç½®

7. **`REAL_MAP_INTEGRATION_GUIDE.md`**
   - å®Œæ•´çš„é›†æˆè¯´æ˜Ž
   - æŠ€æœ¯å®žçŽ°ç»†èŠ‚

8. **`QUICK_START_REAL_MAP.md`**
   - 5 åˆ†é’Ÿå¿«é€Ÿå¼€å§‹æŒ‡å—
   - å¸¸è§é—®é¢˜è§£ç­”

9. **`ENV_CONFIG_TEMPLATE.md`**
   - çŽ¯å¢ƒå˜é‡é…ç½®æ¨¡æ¿
   - ä¸åŒçŽ¯å¢ƒçš„é…ç½®ç¤ºä¾‹

10. **`LOCATION_ISSUE_ANALYSIS.md`** (å·²å­˜åœ¨)
    - å®šä½é—®é¢˜åˆ†æž
    - çŽ°å·²æ›´æ–°åŒ…å«çœŸå®ž API ä¿¡æ¯

11. **`SIMULATOR_LOCATION_SETUP.md`** (å·²å­˜åœ¨)
    - iOS æ¨¡æ‹Ÿå™¨ä½ç½®è®¾ç½®

## ðŸš€ å¦‚ä½•ä½¿ç”¨

### æ–¹å¼ 1: é˜…è¯»å¿«é€Ÿå¼€å§‹æŒ‡å—

```bash
# æ‰“å¼€å¿«é€Ÿå¼€å§‹æŒ‡å—
cat QUICK_START_REAL_MAP.md
```

5 åˆ†é’Ÿå³å¯å®Œæˆé…ç½®ï¼

### æ–¹å¼ 2: ç›´æŽ¥é…ç½®

```bash
# 1. åˆ›å»º .env æ–‡ä»¶
cat > .env << 'EOF'
GOOGLE_MAPS_API_KEY=ä½ çš„APIå¯†é’¥
USE_REAL_MAP_API=true
APP_ENV=development
PORT=3333
EOF

# 2. æ›¿æ¢ API å¯†é’¥
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥çœŸå®žçš„ Google Maps API Key

# 3. å¯åŠ¨æœåŠ¡
pnpm run dev:api

# 4. å¯åŠ¨ç§»åŠ¨åº”ç”¨ï¼ˆæ–°ç»ˆç«¯ï¼‰
cd apps/mobile && pnpm start
```

## ðŸ“Š é…ç½®é€‰é¡¹

### ä½¿ç”¨çœŸå®ž API

```env
GOOGLE_MAPS_API_KEY=AIzaSy...ä½ çš„å¯†é’¥
USE_REAL_MAP_API=true
```

æœåŠ¡å™¨æ—¥å¿—ä¼šæ˜¾ç¤ºï¼š
```
[MapService] Using Google Places API
[MapService] Using Google Directions API
```

### ä½¿ç”¨ Mock æ•°æ®

```env
USE_REAL_MAP_API=false
```

æˆ–è€…ä¸è®¾ç½® `GOOGLE_MAPS_API_KEY`ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨ Mock æ•°æ®ã€‚

æœåŠ¡å™¨æ—¥å¿—ä¼šæ˜¾ç¤ºï¼š
```
[MapService] Using mock places data
[MapService] Using heuristic routing
```

## ðŸ’¡ å…³é”®ç‰¹æ€§

### 1. å‘åŽå…¼å®¹
- âœ… å‰ç«¯ä»£ç æ— éœ€ä»»ä½•ä¿®æ”¹
- âœ… API æŽ¥å£ä¿æŒä¸å˜
- âœ… å¯ä»¥éšæ—¶åˆ‡æ¢å›ž Mock æ•°æ®

### 2. å®‰å…¨æ€§
- âœ… API å¯†é’¥å­˜å‚¨åœ¨åŽç«¯
- âœ… ä¸æš´éœ²åœ¨å‰ç«¯ä»£ç ä¸­
- âœ… æ”¯æŒ IP å’Œ API é™åˆ¶

### 3. æˆæœ¬æŽ§åˆ¶
- âœ… æ¯æœˆ $200 å…è´¹é¢åº¦
- âœ… å¯ä»¥éšæ—¶åˆ‡æ¢åˆ° Mock æ¨¡å¼
- âœ… è‡ªåŠ¨é”™è¯¯å¤„ç†å’Œé™çº§

### 4. çµæ´»æ€§
- âœ… å¼€å‘çŽ¯å¢ƒå¯ç”¨ Mock æ•°æ®
- âœ… ç”Ÿäº§çŽ¯å¢ƒä½¿ç”¨çœŸå®ž API
- âœ… é€šè¿‡çŽ¯å¢ƒå˜é‡è½»æ¾åˆ‡æ¢

## ðŸ”§ æŠ€æœ¯æž¶æž„

### æ•°æ®æµ

```
ç§»åŠ¨åº”ç”¨
   â†“
   â†“ HTTP è¯·æ±‚
   â†“
API æœåŠ¡å™¨ (/map/nearby, /map/route)
   â†“
   â†“ æ£€æŸ¥é…ç½®
   â†“
USE_REAL_MAP_API?
   â”œâ”€ true  â†’ GooglePlacesRepository + GoogleDirectionsEngine
   â””â”€ false â†’ InMemoryPlacesRepository + HeuristicRouteEngine
       â†“
       â†“ API è°ƒç”¨
       â†“
   Google Maps API
```

### ä»£ç ç»„ç»‡

```
services/map/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ providers/
â”‚   â”‚   â”œâ”€â”€ google-places-provider.ts      # Google Places API
â”‚   â”‚   â””â”€â”€ location-provider.ts
â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â””â”€â”€ places-repository.ts           # æŠ½è±¡æŽ¥å£
â”‚   â”œâ”€â”€ routing/
â”‚   â”‚   â”œâ”€â”€ engines/
â”‚   â”‚   â”‚   â”œâ”€â”€ google-directions-engine.ts  # Google Directions
â”‚   â”‚   â”‚   â””â”€â”€ heuristic-engine.ts          # Mock å®žçŽ°
â”‚   â”‚   â”œâ”€â”€ routing-service.ts
â”‚   â”‚   â””â”€â”€ route-engine.ts
â”‚   â””â”€â”€ index.ts                           # ç»Ÿä¸€å¯¼å‡º

services/api/
â””â”€â”€ src/
    â””â”€â”€ routes/
        â””â”€â”€ map.ts                         # æ™ºèƒ½åˆ‡æ¢é€»è¾‘
```

## ðŸ“– æ–‡æ¡£æŒ‡å—

### æ–°ç”¨æˆ·
1. é˜…è¯» `QUICK_START_REAL_MAP.md` - 5 åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹
2. é˜…è¯» `GOOGLE_MAPS_SETUP.md` - è¯¦ç»†é…ç½®æ­¥éª¤

### å¼€å‘è€…
1. é˜…è¯» `REAL_MAP_INTEGRATION_GUIDE.md` - æŠ€æœ¯å®žçŽ°
2. æŸ¥çœ‹ä»£ç æ³¨é‡Šäº†è§£ç»†èŠ‚

### è¿ç»´
1. é˜…è¯» `GOOGLE_MAPS_SETUP.md` çš„å®‰å…¨ç« èŠ‚
2. è®¾ç½® API é™åˆ¶å’Œé…é¢å‘Šè­¦

## ðŸ§ª æµ‹è¯•

### æ‰€æœ‰æµ‹è¯•é€šè¿‡ âœ…

```bash
# TypeScript ç¼–è¯‘
cd services/map && pnpm exec tsc --noEmit  # âœ… é€šè¿‡
cd services/api && pnpm exec tsc --noEmit  # âœ… é€šè¿‡

# å•å…ƒæµ‹è¯•
cd services/map && pnpm test              # âœ… é€šè¿‡
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. API å¯†é’¥å®‰å…¨

- âš ï¸ **ä¸è¦**æäº¤ `.env` æ–‡ä»¶åˆ° Git
- âš ï¸ **ä¸è¦**åœ¨å‰ç«¯ä»£ç ä¸­ä½¿ç”¨ API å¯†é’¥
- âœ… **åŠ¡å¿…**è®¾ç½® API å¯†é’¥é™åˆ¶
- âœ… **åŠ¡å¿…**ç›‘æŽ§ä½¿ç”¨é‡

### 2. æˆæœ¬æŽ§åˆ¶

- ðŸ’° å…è´¹é¢åº¦æ¯æœˆ $200
- ðŸ’° Places API: ~$0.017/æ¬¡
- ðŸ’° Directions API: ~$0.005/æ¬¡
- ðŸ’¡ å¼€å‘æ—¶å¯ä½¿ç”¨ Mock æ•°æ®èŠ‚çœé…é¢

### 3. æ¨¡æ‹Ÿå™¨ä½ç½®

- iOS æ¨¡æ‹Ÿå™¨é»˜è®¤åœ¨æ—§é‡‘å±±
- ä½¿ç”¨ `pnpm run sim:location:nyc` è®¾ç½®ä¸ºçº½çº¦
- ä½¿ç”¨ `pnpm run sim:location:sf` è®¾ç½®ä¸ºæ—§é‡‘å±±

## ðŸŽ‰ å®ŒæˆçŠ¶æ€

### âœ… åŽç«¯é›†æˆ
- [x] Google Places API å®žçŽ°
- [x] Google Directions API å®žçŽ°
- [x] æ™ºèƒ½åˆ‡æ¢é€»è¾‘
- [x] çŽ¯å¢ƒå˜é‡é…ç½®
- [x] ç±»åž‹å®šä¹‰å®Œå–„
- [x] é”™è¯¯å¤„ç†
- [x] æ‰€æœ‰æµ‹è¯•é€šè¿‡

### âœ… å‰ç«¯å…¼å®¹
- [x] API æŽ¥å£ä¿æŒä¸å˜
- [x] æ— éœ€ä¿®æ”¹å‰ç«¯ä»£ç 
- [x] åœ°å›¾æ˜¾ç¤ºæ­£å¸¸
- [x] å¯¼èˆªåŠŸèƒ½æ­£å¸¸

### âœ… æ–‡æ¡£
- [x] å¿«é€Ÿå¼€å§‹æŒ‡å—
- [x] è¯¦ç»†é…ç½®æŒ‡å—
- [x] æŠ€æœ¯å®žçŽ°æ–‡æ¡£
- [x] çŽ¯å¢ƒå˜é‡æ¨¡æ¿
- [x] æ•…éšœæŽ’æŸ¥æŒ‡å—

### âœ… å·¥å…·
- [x] æ¨¡æ‹Ÿå™¨ä½ç½®è®¾ç½®è„šæœ¬
- [x] npm å‘½ä»¤å¿«æ·æ–¹å¼

## ðŸš¦ ä¸‹ä¸€æ­¥

### ç«‹å³å¼€å§‹

1. èŽ·å– Google Maps API å¯†é’¥
2. é…ç½® `.env` æ–‡ä»¶
3. å¯åŠ¨æœåŠ¡
4. å¼€å§‹ä½¿ç”¨çœŸå®žåœ°å›¾ï¼

### å¯é€‰ä¼˜åŒ–

1. **ç¼“å­˜**: æ·»åŠ åœ°ç‚¹æœç´¢ç»“æžœç¼“å­˜
2. **ç¦»çº¿**: ç¼“å­˜æœ€è¿‘è®¿é—®çš„åœ°ç‚¹
3. **é¢„æµ‹**: åŸºäºŽåŽ†å²è®°å½•é¢„åŠ è½½åœ°ç‚¹
4. **æ›´å¤šåŸŽå¸‚**: æ·»åŠ æ›´å¤šåŸŽå¸‚çš„ Mock æ•°æ®

### ç”Ÿäº§éƒ¨ç½²

1. è®¾ç½®ç”Ÿäº§çŽ¯å¢ƒ API å¯†é’¥
2. é…ç½® API é™åˆ¶å’Œ IP ç™½åå•
3. è®¾ç½®è®¡è´¹å‘Šè­¦
4. ç›‘æŽ§ API ä½¿ç”¨é‡

## ðŸ“š ç›¸å…³èµ„æº

- [Google Maps Platform](https://mapsplatform.google.com/)
- [Places API æ–‡æ¡£](https://developers.google.com/maps/documentation/places/web-service)
- [Directions API æ–‡æ¡£](https://developers.google.com/maps/documentation/directions)

---

## ðŸŽŠ æ­å–œï¼

æ‚¨çš„åº”ç”¨çŽ°åœ¨æ‹¥æœ‰å®Œæ•´çš„çœŸå®žåœ°å›¾åŠŸèƒ½ï¼

ä»Ž Mock æ•°æ®åˆ°çœŸå®ž API çš„æ— ç¼å‡çº§å·²ç»å®Œæˆã€‚æ‚¨å¯ä»¥ï¼š
- ðŸ—ºï¸ æœç´¢çœŸå®žçš„é™„è¿‘åœ°ç‚¹
- ðŸ§­ èŽ·å–ç²¾ç¡®çš„å¯¼èˆªè·¯çº¿
- ðŸ”„ éšæ—¶åˆ‡æ¢ Mock/çœŸå®žæ¨¡å¼
- ðŸ”’ å®‰å…¨åœ°ç®¡ç† API å¯†é’¥
- ðŸ’° æŽ§åˆ¶ API ä½¿ç”¨æˆæœ¬

å¼€å§‹æŽ¢ç´¢çœŸå®žä¸–ç•Œçš„åœ°ç‚¹å’Œè·¯çº¿å§ï¼âœ¨



